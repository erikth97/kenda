---
/**
 * FormSection.astro
 * 
 * Componente que implementa la secci√≥n de formulario para distribuidores KENDA.
 * Incluye validaci√≥n de campos y manejo de env√≠o mediante JSON a Make webhook.
 * Con dise√±o responsive optimizado para dispositivos m√≥viles.
 */
import Section from '../common/Section.astro';
import Container from '../../layouts/Container.astro';
---

<Section id="formulario" background="kenda-bg" spacing="lg">
  <!-- Cuadr√≠cula uniforme sin degradados -->
  <div class="absolute inset-0 w-full h-full uniform-grid"></div>
  
  <!-- Contenido del formulario -->
  <Container size="md" className="max-w-3xl px-4 sm:px-6 md:px-8 relative z-10">
    <div class="bg-white rounded-3xl shadow-xl p-6 sm:p-8 md:p-12 border border-gray-100">
      <!-- T√≠tulo y subt√≠tulo con tama√±o adaptativo -->
      <div class="text-center mb-12 md:mb-14">
        <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-3">Formulario</h2>
        <p class="text-base sm:text-lg text-gray-700 font-medium">M√°s de 5,000 distribuidores</p>
      </div>
      
      <form id="distributor-form" class="space-y-6 sm:space-y-8 md:space-y-10">
        <!-- Campo Nombre -->
        <div class="mb-6 sm:mb-8 md:mb-10">
          <label for="nombre" class="block text-gray-800 font-semibold mb-3 text-base">Nombre completo</label>
          <input 
            type="text" 
            id="nombre" 
            name="nombre" 
            class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium placeholder-gray-500" 
            placeholder="Ej: Juan P√©rez Garc√≠a"
            required 
            aria-describedby="error-nombre"
            aria-invalid="false"
          />
          <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-nombre" role="alert">Este campo es obligatorio</p>
        </div>
        
        <!-- Fila de Email y Tel√©fono con etiquetas fijas -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 mb-6 sm:mb-8 md:mb-10">
          <!-- Campo Email -->
          <div>
            <label for="email" class="block text-gray-800 font-semibold mb-3 text-base">Correo electr√≥nico</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium placeholder-gray-500" 
              placeholder="tu@email.com"
              required 
              aria-describedby="error-email"
              aria-invalid="false"
            />
            <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-email" role="alert">Ingrese un correo electr√≥nico v√°lido</p>
          </div>
          
          <!-- Campo Celular/Tel√©fono -->
          <div>
            <label for="telefono" class="block text-gray-800 font-semibold mb-3 text-base">Tel√©fono</label>
            <input 
              type="tel" 
              id="telefono" 
              name="telefono" 
              class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium placeholder-gray-500" 
              placeholder="55 1234 5678"
              required 
              pattern="[\d\s\-\(\)\+]{10,15}"
              maxlength="15"
              title="Ingrese un n√∫mero de tel√©fono mexicano v√°lido"
              aria-describedby="error-telefono"
              aria-invalid="false"
            />
            <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-telefono" role="alert">Ingrese un tel√©fono v√°lido (10 d√≠gitos m√≠nimo)</p>
          </div>
        </div>
        
        <!-- Campos de selecci√≥n con mejor jerarqu√≠a visual y espaciado optimizado -->
        <div class="space-y-6 sm:space-y-8 md:space-y-10 mb-8 sm:mb-10 md:mb-12">
          <div>
            <label for="giroComercial" class="block text-gray-800 font-semibold mb-4 text-base leading-relaxed">¬øTienes un negocio enfocado al sector de motocicletas o autos?</label>
            <div class="relative">
              <select 
                id="giroComercial" 
                name="giroComercial" 
                class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none appearance-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium cursor-pointer" 
                required
                aria-describedby="error-giroComercial"
                aria-invalid="false"
              >
                <option value="" disabled selected class="text-gray-400 italic">Selecciona una opci√≥n</option>
                <option value="agencia" class="text-gray-900 font-medium">Agencia de motos</option>
                <option value="taller" class="text-gray-900 font-medium">Taller mec√°nico</option>
                <option value="refaccionaria" class="text-gray-900 font-medium">Refaccionaria</option>
                <option value="otro" class="text-gray-900 font-medium">Otro</option>
                <option value="no" class="text-gray-900 font-medium">No</option>
              </select>
              <!-- √çcono de flecha para el select -->
              <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                <svg class="w-5 h-5 text-gray-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-giroComercial" role="alert">Seleccione una opci√≥n</p>
            </div>
          </div>
          
          <div>
            <label for="estado" class="block text-gray-800 font-semibold mb-4 text-base leading-relaxed">Estado</label>
            <div class="relative">
              <select 
                id="estado" 
                name="estado" 
                class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none appearance-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium cursor-pointer" 
                required
                aria-describedby="error-estado"
                aria-invalid="false"
              >
                <option value="" disabled selected class="text-gray-400 italic">Selecciona tu estado</option>
                <option value="aguascalientes" class="text-gray-900 font-medium">Aguascalientes</option>
                <option value="baja-california" class="text-gray-900 font-medium">Baja California</option>
                <option value="baja-california-sur" class="text-gray-900 font-medium">Baja California Sur</option>
                <option value="campeche" class="text-gray-900 font-medium">Campeche</option>
                <option value="chiapas" class="text-gray-900 font-medium">Chiapas</option>
                <option value="chihuahua" class="text-gray-900 font-medium">Chihuahua</option>
                <option value="ciudad-de-mexico" class="text-gray-900 font-medium">Ciudad de M√©xico</option>
                <option value="coahuila" class="text-gray-900 font-medium">Coahuila</option>
                <option value="colima" class="text-gray-900 font-medium">Colima</option>
                <option value="durango" class="text-gray-900 font-medium">Durango</option>
                <option value="guanajuato" class="text-gray-900 font-medium">Guanajuato</option>
                <option value="guerrero" class="text-gray-900 font-medium">Guerrero</option>
                <option value="hidalgo" class="text-gray-900 font-medium">Hidalgo</option>
                <option value="jalisco" class="text-gray-900 font-medium">Jalisco</option>
                <option value="mexico" class="text-gray-900 font-medium">M√©xico</option>
                <option value="michoacan" class="text-gray-900 font-medium">Michoac√°n</option>
                <option value="morelos" class="text-gray-900 font-medium">Morelos</option>
                <option value="nayarit" class="text-gray-900 font-medium">Nayarit</option>
                <option value="nuevo-leon" class="text-gray-900 font-medium">Nuevo Le√≥n</option>
                <option value="oaxaca" class="text-gray-900 font-medium">Oaxaca</option>
                <option value="puebla" class="text-gray-900 font-medium">Puebla</option>
                <option value="queretaro" class="text-gray-900 font-medium">Quer√©taro</option>
                <option value="quintana-roo" class="text-gray-900 font-medium">Quintana Roo</option>
                <option value="san-luis-potosi" class="text-gray-900 font-medium">San Luis Potos√≠</option>
                <option value="sinaloa" class="text-gray-900 font-medium">Sinaloa</option>
                <option value="sonora" class="text-gray-900 font-medium">Sonora</option>
                <option value="tabasco" class="text-gray-900 font-medium">Tabasco</option>
                <option value="tamaulipas" class="text-gray-900 font-medium">Tamaulipas</option>
                <option value="tlaxcala" class="text-gray-900 font-medium">Tlaxcala</option>
                <option value="veracruz" class="text-gray-900 font-medium">Veracruz</option>
                <option value="yucatan" class="text-gray-900 font-medium">Yucat√°n</option>
                <option value="zacatecas" class="text-gray-900 font-medium">Zacatecas</option>
              </select>
              <!-- √çcono de flecha para el select -->
              <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                <svg class="w-5 h-5 text-gray-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-estado" role="alert">Seleccione una opci√≥n</p>
            </div>
            
            <!-- üÜï NUEVO: Elemento para mostrar informaci√≥n del promotor -->
            <div id="promotor-info" class="hidden mt-3" role="status" aria-live="polite">
              <!-- Contenido din√°mico se insertar√° aqu√≠ -->
            </div>
          </div>
          
          <div>
            <label for="tipoNegocio" class="block text-gray-800 font-semibold mb-4 text-base leading-relaxed">¬øCu√°l es tu capital de inversi√≥n?</label>
            <div class="relative">
              <select 
                id="tipoNegocio" 
                name="tipoNegocio" 
                class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none appearance-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium cursor-pointer" 
                required
                aria-describedby="error-tipoNegocio"
                aria-invalid="false"
              >
                <option value="" disabled selected class="text-gray-400 italic">Selecciona el monto</option>
                <option value="1500000" class="text-gray-900 font-medium">$50,000 - $100,000 MXN</option>
                <option value="2000000" class="text-gray-900 font-medium">$100,000 - $250,000 MXN</option>
                <option value="mas-2000000" class="text-gray-900 font-medium">$250,000 - $500,000 MXN</option>
                <option value="mas-2000000" class="text-gray-900 font-medium">M√°s de $500,000 MXN</option>
              </select>
              <!-- √çcono de flecha para el select -->
              <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                <svg class="w-5 h-5 text-gray-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-tipoNegocio" role="alert">Seleccione una opci√≥n</p>
            </div>
          </div>

          <div>
            <label for="iniciarOperaciones" class="block text-gray-800 font-semibold mb-4 text-base leading-relaxed">¬øCu√°ndo te gustar√≠a iniciar operaciones?</label>
            <div class="relative">
              <select 
                id="iniciarOperaciones" 
                name="inicioOperaciones" 
                class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-kenda-orange focus:border-kenda-orange focus:outline-none appearance-none transition-all duration-300 hover:bg-gray-100 hover:border-gray-300 text-gray-900 font-medium cursor-pointer" 
                required
                aria-describedby="error-iniciarOperaciones"
                aria-invalid="false"
              >
                <option value="" disabled selected class="text-gray-400 italic">Selecciona el tiempo</option>
                <option value="3-meses" class="text-gray-900 font-medium">3 meses</option>
                <option value="6-meses" class="text-gray-900 font-medium">6 meses</option>
                <option value="12-meses" class="text-gray-900 font-medium">12 meses</option>
              </select>
              <!-- √çcono de flecha para el select -->
              <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                <svg class="w-5 h-5 text-gray-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              <p class="error-message text-red-600 text-sm mt-2 ml-1 hidden font-medium" id="error-iniciarOperaciones" role="alert">Seleccione una opci√≥n</p>
            </div>
          </div>
        </div>
        
        <!-- Bot√≥n de env√≠o m√°s prominente y centrado con responsive mejorado -->
        <div class="flex justify-center pt-6 sm:pt-8 pb-4">
          <button 
            type="submit" 
            id="submit-button"
            class="w-full sm:w-auto px-8 sm:px-12 md:px-16 lg:px-20 py-3 sm:py-4 md:py-5 bg-kenda-orange hover:bg-orange-600 text-white font-bold text-base sm:text-lg rounded-full transition-all duration-300 pulse-effect transform hover:scale-105 hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-orange-300 disabled:opacity-70 disabled:cursor-not-allowed disabled:transform-none max-w-sm sm:max-w-none"
            aria-describedby="submit-status"
          >
            <span class="flex items-center justify-center">
              <span id="button-text">Enviar formulario</span>
              <span id="button-spinner" class="ml-3 hidden animate-spin-once">
                <svg class="w-5 h-5 sm:w-6 sm:h-6 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
            </span>
          </button>
        </div>
        <div id="submit-status" class="sr-only" aria-live="polite"></div>
      </form>
    </div>
  </Container>
</Section>

<!-- Toast notification con dise√±o mejorado y responsive -->
<div id="toast-notification" class="fixed bottom-4 left-4 right-4 sm:bottom-4 sm:right-4 sm:left-auto bg-green-500 text-white rounded-xl shadow-xl z-50 hidden w-full sm:w-80 md:w-96 max-w-[calc(100vw-2rem)] sm:max-w-none overflow-hidden" role="alert" aria-live="assertive">
  <div class="flex items-start p-4 sm:p-5">
    <!-- √çcono SVG en cuadro redondeado -->
    <div class="flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3 sm:mr-4 mt-0.5">
      <!-- √çcono de √©xito -->
      <svg id="toast-success-icon" class="w-8 h-8 sm:w-10 sm:h-10 text-green-600 opacity-0 mx-auto my-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
      </svg>
      
      <!-- √çcono de error -->
      <svg id="toast-error-icon" class="w-6 h-6 sm:w-7 sm:h-7 text-white opacity-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </div>
    
    <!-- Contenido del texto -->
    <div class="flex-1 min-w-0">
      <h4 id="toast-title" class="text-base sm:text-lg font-semibold text-white mb-1 leading-tight">¬°Gracias por tu inter√©s!</h4>
      <p id="toast-message" class="text-sm sm:text-base text-white opacity-90 leading-relaxed pr-2">Tu solicitud fue enviada exitosamente. Nuestro equipo se pondr√° en contacto contigo pronto.</p>
    </div>
    
    <!-- Bot√≥n de cierre -->
    <button id="close-toast" class="flex-shrink-0 ml-2 sm:ml-4 w-6 h-6 sm:w-7 sm:h-7 text-white hover:text-gray-200 transition-colors duration-200 rounded-md hover:bg-white hover:bg-opacity-10 flex items-center justify-center" aria-label="Cerrar notificaci√≥n">
      <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
  
  <!-- Barra de progreso opcional -->
  <div class="h-1 bg-white bg-opacity-20">
    <div id="toast-progress" class="h-full bg-white bg-opacity-40 transition-all duration-300 ease-linear" style="width: 100%"></div>
  </div>
</div>

<!-- Canvas para el confeti -->
<canvas id="confetti-canvas" class="fixed inset-0 pointer-events-none z-40 hidden" aria-hidden="true"></canvas>

<style>
  /* Cuadr√≠cula uniforme sin degradados */
  .uniform-grid {
    background-image: 
      linear-gradient(rgba(255, 255, 255, 1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 1) 1px, transparent 1px);
    background-size: 40px 40px;
    background-position: center;
    z-index: 1;
  }
  
  /* Animaci√≥n de un solo giro para el bot√≥n */
  @keyframes spin-once {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .animate-spin-once {
    animation: spin-once 0.5s ease-in-out forwards;
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  /* Transiciones suaves para los campos y errores */
  .error-message {
    transition: all 0.3s ease;
  }
  
  input:focus, select:focus {
    transition: all 0.3s ease;
  }

  /* Estados de validaci√≥n visual */
  .field-valid {
    border-color: #10b981 !important;
    background-color: #f0fdf4 !important;
  }
  
  .field-invalid {
    border-color: #ef4444 !important;
    background-color: #fef2f2 !important;
  }

  /* Efectos de hover mejorados para selects */
  select:hover + div svg {
    transform: rotate(180deg);
  }

  /* Mejorar contraste de placeholders */
  ::placeholder {
    color: #9CA3AF;
    opacity: 1;
  }

  /* Clases para lectores de pantalla */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Animaci√≥n de pulso simple y elegante */
  @keyframes pulse-gentle {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
    }
    50% {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(255, 87, 34, 0.4);
    }
  }

  .pulse-effect {
    animation: pulse-gentle 2s ease-in-out infinite;
  }

  .pulse-effect:hover {
    animation: pulse-gentle 1s ease-in-out infinite;
  }

  .pulse-effect:disabled {
    animation: none;
    box-shadow: none;
  }
</style>

<script is:inline>
  // üÜï NUEVO: Base de datos de promotores por estado
  const PROMOTORES_POR_ESTADO = {
    'aguascalientes': {
      nombre: 'FRANCISCO JAVIER PE√ëA',
      whatsapp: '6671207132',
      email: 'ventas.pacifico2@motosyequipos.com',
      zonas: ['ZACATECAS', 'AGUASCALIENTES', 'NAYARIT', 'JALISCO']
    },
    'baja-california': {
      nombre: 'CHRISTIAN PAUL DAVIZON VILLEGAS',
      whatsapp: '6691229912',
      email: 'ventas.pacifico3@motosyequipos.com',
      zonas: ['SINALOA', 'SONORA', 'BAJA CALIFORNIA SUR', 'NORTE Y DURANGO']
    },
    'baja-california-sur': {
      nombre: 'CHRISTIAN PAUL DAVIZON VILLEGAS',
      whatsapp: '6691229912',
      email: 'ventas.pacifico3@motosyequipos.com',
      zonas: ['SINALOA', 'SONORA', 'BAJA CALIFORNIA SUR', 'NORTE Y DURANGO']
    },
    'campeche': {
      nombre: 'ULISES MARTIN VILLEGAS',
      whatsapp: '9993965148',
      email: 'ventas.peninsula@motosyequipos.com',
      zonas: ['YUCAT√ÅN', 'CAMPECHE', 'QUINTANA ROO']
    },
    'chiapas': {
      nombre: 'JOSE DANIEL RAMOS MART√çNEZ',
      whatsapp: '9626225169',
      email: 'ventas.suroeste@motosyequipos.com',
      zonas: ['CHIAPAS']
    },
    'chihuahua': {
      nombre: 'JUAN CARLOS HERNANDEZ PACHECO',
      whatsapp: '8126229318',
      email: 'ventas.norte@motosyequipos.com',
      zonas: ['CHIHUAHUA', 'NUEVO LEON', 'COAHUILA', 'TAMAULIPAS']
    },
'ciudad-de-mexico': {
      nombre: 'ALEJANDRO ROBERTO PI√ëA GARCIA',
      whatsapp: '5527378228',
      email: 'ventas.sur@motosyequipos.com',
      zonas: ['CDMX', 'EDO. MEXICO', 'PUEBLA', 'TLAXCALA'],
      alternativo: {
        nombre: 'SERGIO AARON CARDENAS GARCIA',
        whatsapp: '5543038476',
        email: 'ventas.sureste@motosyequipos.com'
      }
    },
    'coahuila': {
      nombre: 'JUAN CARLOS HERNANDEZ PACHECO',
      whatsapp: '8126229318',
      email: 'ventas.norte@motosyequipos.com',
      zonas: ['CHIHUAHUA', 'NUEVO LEON', 'COAHUILA', 'TAMAULIPAS']
    },
    'colima': {
      nombre: 'FRANCISCO JAVIER RENTERIA',
      whatsapp: '3311520857',
      email: 'ventas.jalisco@motosyequipos.com',
      zonas: ['JALISCO', 'COLIMA', 'MICHOAC√ÅN']
    },
    'durango': {
      nombre: 'CHRISTIAN PAUL DAVIZON VILLEGAS',
      whatsapp: '6691229912',
      email: 'ventas.pacifico3@motosyequipos.com',
      zonas: ['SINALOA', 'SONORA', 'BAJA CALIFORNIA SUR', 'NORTE Y DURANGO']
    },
    'guanajuato': {
      nombre: 'RICARDO REBOLLEDO ORTIZ',
      whatsapp: '4451042272',
      email: 'ventas.bajio@motosyequipos.com',
      zonas: ['GUANAJUATO', 'SAN LUIS POTOS√ç']
    },
    'guerrero': {
      nombre: 'IV√ÅN HERN√ÅNDEZ LEAL',
      whatsapp: '3511779622',
      email: 'ventas.pacifico4@motosyequipos.com',
      zonas: ['GUERRERO', 'MORELOS', 'MICHOAC√ÅN']
    },
    'hidalgo': {
      nombre: 'OCTAVIO NAVARRETE FERNANDEZ',
      whatsapp: '5562404656',
      email: 'ventas.mexico@motosyequipos.com',
      zonas: ['HIDALGO', 'QUER√âTARO', 'EDO. MEXICO']
    },
    'jalisco': {
      nombre: 'FRANCISCO JAVIER RENTERIA',
      whatsapp: '3311520857',
      email: 'ventas.jalisco@motosyequipos.com',
      zonas: ['JALISCO', 'COLIMA', 'MICHOAC√ÅN']
    },
    'mexico': {
      nombre: 'ALEJANDRO ROBERTO PI√ëA GARCIA',
      whatsapp: '5527378228',
      email: 'ventas.sur@motosyequipos.com',
      zonas: ['CDMX', 'EDO. MEXICO', 'PUEBLA', 'TLAXCALA'],
      alternativo: {
        nombre: 'SERGIO AARON CARDENAS GARCIA',
        whatsapp: '5543038476',
        email: 'ventas.sureste@motosyequipos.com'
      }
    },
    'michoacan': {
      nombre: 'FRANCISCO JAVIER RENTERIA',
      whatsapp: '3311520857',
      email: 'ventas.jalisco@motosyequipos.com',
      zonas: ['JALISCO', 'COLIMA', 'MICHOAC√ÅN']
    },
    'morelos': {
      nombre: 'IV√ÅN HERN√ÅNDEZ LEAL',
      whatsapp: '3511779622',
      email: 'ventas.pacifico4@motosyequipos.com',
      zonas: ['GUERRERO', 'MORELOS', 'MICHOAC√ÅN']
    },
    'nayarit': {
      nombre: 'FRANCISCO JAVIER PE√ëA',
      whatsapp: '6671207132',
      email: 'ventas.pacifico2@motosyequipos.com',
      zonas: ['ZACATECAS', 'AGUASCALIENTES', 'NAYARIT', 'JALISCO']
    },
    'nuevo-leon': {
      nombre: 'JUAN CARLOS HERNANDEZ PACHECO',
      whatsapp: '8126229318',
      email: 'ventas.norte@motosyequipos.com',
      zonas: ['CHIHUAHUA', 'NUEVO LEON', 'COAHUILA', 'TAMAULIPAS']
    },
    'oaxaca': {
      nombre: 'LIBER HOMERO CABALLERO VILLA',
      whatsapp: '5554336749',
      email: 'ventas.oaxaca@motosyequipos.com',
      zonas: ['OAXACA']
    },
    'puebla': {
      nombre: 'ALEJANDRO ROBERTO PI√ëA GARCIA',
      whatsapp: '5527378228',
      email: 'ventas.sur@motosyequipos.com',
      zonas: ['CDMX', 'EDO. MEXICO', 'PUEBLA', 'TLAXCALA']
    },
    'queretaro': {
      nombre: 'OCTAVIO NAVARRETE FERNANDEZ',
      whatsapp: '5562404656',
      email: 'ventas.mexico@motosyequipos.com',
      zonas: ['HIDALGO', 'QUER√âTARO', 'EDO. MEXICO']
    },
    'quintana-roo': {
      nombre: 'ULISES MARTIN VILLEGAS',
      whatsapp: '9993965148',
      email: 'ventas.peninsula@motosyequipos.com',
      zonas: ['YUCAT√ÅN', 'CAMPECHE', 'QUINTANA ROO']
    },
    'san-luis-potosi': {
      nombre: 'RICARDO REBOLLEDO ORTIZ',
      whatsapp: '4451042272',
      email: 'ventas.bajio@motosyequipos.com',
      zonas: ['GUANAJUATO', 'SAN LUIS POTOS√ç']
    },
    'sinaloa': {
      nombre: 'CHRISTIAN PAUL DAVIZON VILLEGAS',
      whatsapp: '6691229912',
      email: 'ventas.pacifico3@motosyequipos.com',
      zonas: ['SINALOA', 'SONORA', 'BAJA CALIFORNIA SUR', 'NORTE Y DURANGO']
    },
    'sonora': {
      nombre: 'CHRISTIAN PAUL DAVIZON VILLEGAS',
      whatsapp: '6691229912',
      email: 'ventas.pacifico3@motosyequipos.com',
      zonas: ['SINALOA', 'SONORA', 'BAJA CALIFORNIA SUR', 'NORTE Y DURANGO']
    },
    'tabasco': {
      nombre: 'JORGE URTECHO REJON',
      whatsapp: '9991098579',
      email: 'ventas.golfosur@motosyequipos.com',
      zonas: ['CAMPECHE(NTE.)', 'TABASCO', 'VERACRUZ (SUR)']
    },
    'tamaulipas': {
      nombre: 'JUAN CARLOS HERNANDEZ PACHECO',
      whatsapp: '8126229318',
      email: 'ventas.norte@motosyequipos.com',
      zonas: ['CHIHUAHUA', 'NUEVO LEON', 'COAHUILA', 'TAMAULIPAS']
    },
    'tlaxcala': {
      nombre: 'ALEJANDRO ROBERTO PI√ëA GARCIA',
      whatsapp: '5527378228',
      email: 'ventas.sur@motosyequipos.com',
      zonas: ['CDMX', 'EDO. MEXICO', 'PUEBLA', 'TLAXCALA']
    },
    'veracruz': {
      nombre: 'MIGUEL ANGEL GZZ VIDAL',
      whatsapp: '2321033094',
      email: 'ventas.veracruz@motosyequipos.com',
      zonas: ['VERACRUZ']
    },
    'yucatan': {
      nombre: 'ULISES MARTIN VILLEGAS',
      whatsapp: '9993965148',
      email: 'ventas.peninsula@motosyequipos.com',
      zonas: ['YUCAT√ÅN', 'CAMPECHE', 'QUINTANA ROO']
    },
    'zacatecas': {
      nombre: 'FRANCISCO JAVIER PE√ëA',
      whatsapp: '6671207132',
      email: 'ventas.pacifico2@motosyequipos.com',
      zonas: ['ZACATECAS', 'AGUASCALIENTES', 'NAYARIT', 'JALISCO']
    }
  };

  // üÜï NUEVO: Promotor por defecto para casos no encontrados
  const PROMOTOR_DEFAULT = {
    nombre: 'COORDINADOR GENERAL',
    whatsapp: '5555555555', // ‚ö†Ô∏è CAMBIAR por n√∫mero real de coordinaci√≥n
    email: 'coordinacion@motosyequipos.com', // ‚ö†Ô∏è CAMBIAR por email real
    esDefault: true
  };

  // Script principal contin√∫a...
  document.addEventListener('DOMContentLoaded', function() {
    // 1. Declaraciones de elementos
    const form = document.getElementById('distributor-form');
    const toastNotification = document.getElementById('toast-notification');
    const closeToastButton = document.getElementById('close-toast');
    const confettiCanvas = document.getElementById('confetti-canvas');
    const submitButton = document.getElementById('submit-button');
    const buttonText = document.getElementById('button-text');
    const buttonSpinner = document.getElementById('button-spinner');
    const submitStatus = document.getElementById('submit-status');
    
    // 2. Verificaci√≥n de elementos
    if (!form || !toastNotification || !confettiCanvas || !submitButton) {
      console.error("Algunos elementos no se encontraron");
      return;
    }
    
    // 3. Variables globales del componente
    let toastTimer;
    const isMobile = window.innerWidth < 768;
    
    // 4. Funciones auxiliares mejoradas
    function showError(fieldId, show) {
      const errorElement = document.getElementById(`error-${fieldId}`);
      const fieldElement = document.getElementById(fieldId);
      
      if (errorElement && fieldElement) {
        if (show) {
          errorElement.classList.remove('hidden');
          fieldElement.classList.add('ring-2', 'ring-red-500', 'field-invalid');
          fieldElement.classList.remove('ring-kenda-orange', 'field-valid');
          fieldElement.setAttribute('aria-invalid', 'true');
        } else {
          errorElement.classList.add('hidden');
          fieldElement.classList.remove('ring-2', 'ring-red-500', 'field-invalid');
          fieldElement.setAttribute('aria-invalid', 'false');
        }
      }
    }
    
    function showSuccess(fieldId) {
      const fieldElement = document.getElementById(fieldId);
      if (fieldElement) {
        fieldElement.classList.add('field-valid');
        fieldElement.classList.remove('field-invalid', 'ring-red-500');
        fieldElement.setAttribute('aria-invalid', 'false');
      }
    }
    
    // üÜï NUEVO: Funci√≥n para resolver promotor basado en estado seleccionado
    function resolverPromotor(estadoSeleccionado) {
      console.log(`üîç Resolviendo promotor para estado: ${estadoSeleccionado}`);
      
      // Buscar promotor directo
      let promotor = PROMOTORES_POR_ESTADO[estadoSeleccionado];
      
      if (promotor) {
        console.log(`‚úÖ Promotor encontrado: ${promotor.nombre} (${promotor.whatsapp})`);
        return {
          ...promotor,
          esDefault: false
        };
      }
      
      // Si no se encuentra, usar promotor por defecto
      console.warn(`‚ö†Ô∏è No se encontr√≥ promotor para estado: ${estadoSeleccionado}, usando default`);
      return PROMOTOR_DEFAULT;
    }
    
    // üÜï NUEVO: Funci√≥n para validar datos del promotor
    function validarDatosPromotor(promotor) {
      const errores = [];
      
      if (!promotor.whatsapp || promotor.whatsapp.toString().length < 10) {
        errores.push('N√∫mero de WhatsApp del promotor inv√°lido');
      }
      
      if (!promotor.email || !promotor.email.includes('@')) {
        errores.push('Email del promotor inv√°lido');
      }
      
      if (!promotor.nombre || promotor.nombre.trim().length === 0) {
        errores.push('Nombre del promotor inv√°lido');
      }
      
      if (errores.length > 0) {
        console.error('‚ùå Errores en datos del promotor:', errores);
        return false;
      }
      
      return true;
    }

    // üÜï NUEVO: Funci√≥n para mostrar informaci√≥n del promotor al usuario
    function mostrarInfoPromotor(promotor) {
      const infoElement = document.getElementById('promotor-info');
      
      if (!infoElement) {
        console.error('‚ùå Elemento promotor-info no encontrado');
        return;
      }
      
      if (!promotor.esDefault) {
        infoElement.innerHTML = `
          <div class="bg-kenda-orange bg-opacity-10 border border-kenda-orange rounded-xl p-4 transition-all duration-300">
            <div class="flex items-start">
              <div class="flex-shrink-0 w-10 h-10 bg-kenda-orange bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                <svg class="w-5 h-5 text-kenda-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
              </div>
              <div class="flex-1">
                <h4 class="text-sm font-semibold text-gray-900 mb-1">Tu asesor de zona asignado</h4>
                <p class="text-sm text-gray-700 font-medium">${promotor.nombre}</p>
                <p class="text-xs text-gray-600 mt-1">Se pondr√° en contacto contigo despu√©s de enviar el formulario</p>
              </div>
            </div>
          </div>
        `;
        infoElement.classList.remove('hidden');
        console.log(`üì± Mostrando info del promotor: ${promotor.nombre}`);
      } else {
        infoElement.classList.add('hidden');
      }
    }

    function validateField(field) {
      const fieldId = field.id;
      
      // Ocultar mensaje de error al iniciar validaci√≥n
      showError(fieldId, false);
      
      // Validaci√≥n especial para tel√©fono (formato mexicano mejorado)
      if (fieldId === 'telefono') {
        const value = field.value.replace(/\D/g, ''); // Quitar todo excepto n√∫meros
        if (value.length < 10 || value.length > 15) {
          showError(fieldId, true);
          return false;
        }
        showSuccess(fieldId);
        return true;
      }
      
      // Para todos los dem√°s campos, usar validaci√≥n HTML5 b√°sica
      const isValid = field.checkValidity();
      
      if (!isValid) {
        showError(fieldId, true);
        return false;
      }
      
      showSuccess(fieldId);
      return true;
    }
    // 5. Funci√≥n para mostrar el toast mejorada con iconos SVG
    function showToast(type = 'success', message = 'Formulario enviado correctamente.', title = 'Success') {
      // Limpiar cualquier temporizador anterior
      if (toastTimer) {
        clearTimeout(toastTimer);
      }
      
      // Elementos del toast
      const toastEl = toastNotification;
      const titleEl = document.getElementById('toast-title');
      const messageEl = document.getElementById('toast-message');
      const successIcon = document.getElementById('toast-success-icon');
      const errorIcon = document.getElementById('toast-error-icon');
      const progressBar = document.getElementById('toast-progress');
      
      if (type === 'error') {
        // Configurar para error
        toastEl.classList.remove('bg-green-500');
        toastEl.classList.add('bg-red-500');
        titleEl.textContent = title || 'Error';
        
        // Mostrar √≠cono de error, ocultar √©xito
        if (successIcon) successIcon.classList.add('opacity-0');
        if (errorIcon) errorIcon.classList.remove('opacity-0');
      } else {
        // Configurar para √©xito
        toastEl.classList.remove('bg-red-500');
        toastEl.classList.add('bg-green-500');
        titleEl.textContent = title || '¬°√âxito!';
        
        // Mostrar √≠cono de √©xito, ocultar error
        if (errorIcon) errorIcon.classList.add('opacity-0');
        if (successIcon) successIcon.classList.remove('opacity-0');
      }
      
      messageEl.textContent = message;
      
      // Resetear y mostrar barra de progreso
      if (progressBar) {
        progressBar.style.width = '100%';
      }
      
      // Mostrar el toast
      toastNotification.classList.remove('hidden');
      
      // Animar barra de progreso
      if (progressBar) {
        setTimeout(() => {
          progressBar.style.width = '0%';
          progressBar.style.transition = 'width 15s linear';
        }, 100);
      }
      
      // Configurar el temporizador para ocultar despu√©s de 15 segundos
      toastTimer = setTimeout(function() {
        toastNotification.classList.add('hidden');
        // Resetear barra de progreso
        if (progressBar) {
          progressBar.style.width = '100%';
          progressBar.style.transition = 'width 0.3s ease-linear';
        }
      }, 15000);
    }
        
    // 6. Animaci√≥n de confeti mejorada
    const confettiAnimation = {
      canvas: confettiCanvas,
      ctx: null,
      particles: [],
      running: false,
      colors: [
        '#FF5722', '#FFC107', '#2196F3', 
        '#4CAF50', '#9C27B0', '#E91E63',
        '#FFEB3B', '#03A9F4', '#8BC34A'
      ],
      shapes: ['circle', 'square', 'triangle', 'line', 'star'],
      
      init: function() {
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());
      },
      
      resize: function() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      },
      
      createParticle: function(x, y) {
        const sizeMultiplier = isMobile ? 0.7 : 1;
        const shape = this.shapes[Math.floor(Math.random() * this.shapes.length)];
        return {
          x: x || Math.random() * this.canvas.width,
          y: y || Math.random() * this.canvas.height * 0.5,
          size: (Math.random() * 10 + 5) * sizeMultiplier,
          color: this.colors[Math.floor(Math.random() * this.colors.length)],
          opacity: 1,
          shape: shape,
          velocity: {
            x: Math.random() * 6 - 3,
            y: Math.random() * -7 - 3
          },
          rotation: Math.random() * 360,
          rotationSpeed: Math.random() * 10 - 5,
          gravity: 0.1 + Math.random() * 0.1,
          friction: 0.95 + Math.random() * 0.04,
          wobble: Math.random() * 0.2,
          wobbleSpeed: Math.random() * 0.1,
          bounceLimit: Math.floor(Math.random() * 3) + 2,
          bounceCount: 0
        };
      },
      
      drawParticle: function(p) {
        this.ctx.save();
        this.ctx.translate(p.x, p.y);
        this.ctx.rotate(p.rotation * Math.PI / 180);
        this.ctx.globalAlpha = p.opacity;
        this.ctx.fillStyle = p.color;
        
        switch(p.shape) {
          case 'circle':
            this.ctx.beginPath();
            this.ctx.arc(0, 0, p.size / 2, 0, Math.PI * 2);
            this.ctx.fill();
            break;
            
          case 'square':
            this.ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
            break;
            
          case 'triangle':
            this.ctx.beginPath();
            this.ctx.moveTo(0, -p.size / 2);
            this.ctx.lineTo(-p.size / 2, p.size / 2);
            this.ctx.lineTo(p.size / 2, p.size / 2);
            this.ctx.closePath();
            this.ctx.fill();
            break;
            
          case 'line':
            this.ctx.strokeStyle = p.color;
            this.ctx.lineWidth = p.size / 5;
            this.ctx.beginPath();
            this.ctx.moveTo(-p.size, 0);
            this.ctx.lineTo(p.size, 0);
            this.ctx.stroke();
            break;
            
          case 'star':
            this.ctx.beginPath();
            const spikes = 5;
            const outerRadius = p.size / 2;
            const innerRadius = p.size / 4;
            
            for (let i = 0; i < spikes * 2; i++) {
              const radius = i % 2 === 0 ? outerRadius : innerRadius;
              const angle = (i / (spikes * 2)) * Math.PI * 2;
              const x = Math.cos(angle) * radius;
              const y = Math.sin(angle) * radius;
              
              if (i === 0) {
                this.ctx.moveTo(x, y);
              } else {
                this.ctx.lineTo(x, y);
              }
            }
            
            this.ctx.closePath();
            this.ctx.fill();
            break;
        }
        
        this.ctx.restore();
      },
      
      updateParticle: function(p) {
        p.x += Math.sin(Date.now() * p.wobbleSpeed) * p.wobble;
        p.velocity.y += p.gravity;
        p.velocity.x *= p.friction;
        p.velocity.y *= p.friction;
        p.x += p.velocity.x;
        p.y += p.velocity.y;
        p.rotation += p.rotationSpeed;
        p.opacity -= 0.005;
        
        if (p.y >= this.canvas.height - p.size && p.bounceCount < p.bounceLimit) {
          p.velocity.y *= -0.6;
          p.y = this.canvas.height - p.size;
          p.bounceCount++;
          p.size *= 0.9;
        }
        
        if (p.x <= p.size || p.x >= this.canvas.width - p.size) {
          p.velocity.x *= -0.5;
          if (p.x <= p.size) p.x = p.size;
          if (p.x >= this.canvas.width - p.size) p.x = this.canvas.width - p.size;
        }
        
        return p.opacity > 0.05 && p.size > 1;
      },
      
      animate: function() {
        if (!this.running) return;
        
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        for (let i = 0; i < this.particles.length; i++) {
          const p = this.particles[i];
          if (this.updateParticle(p)) {
            this.drawParticle(p);
          } else {
            this.particles.splice(i, 1);
            i--;
          }
        }
        
        if (this.particles.length === 0) {
          this.running = false;
          this.canvas.classList.add('hidden');
          return;
        }
        
        requestAnimationFrame(() => this.animate());
      },
      
      start: function() {
        this.canvas.classList.remove('hidden');
        this.resize();
        this.particles = [];
        this.running = true;
        
        const numPoints = isMobile ? 3 : 5;
        const particlesPerPoint = isMobile ? 20 : 30;
        const pointSpacing = this.canvas.width / numPoints;
        
        for (let j = 0; j < numPoints; j++) {
          const originX = pointSpacing * j + (pointSpacing / 2) + (Math.random() * 100 - 50);
          const originY = -20 + (Math.random() * 40);
          
          for (let i = 0; i < particlesPerPoint; i++) {
            this.particles.push(this.createParticle(originX, originY));
          }
        }
        
        this.animate();
      }
    };
    
    // 7. Control del bot√≥n simplificado
    function controlPulseAnimation() {
      const submitBtn = document.getElementById('submit-button');
      
      // El bot√≥n siempre mantiene su animaci√≥n pulse-effect
      // No necesita l√≥gica adicional ya que se maneja por CSS
      if (submitBtn && !submitBtn.classList.contains('pulse-effect')) {
        submitBtn.classList.add('pulse-effect');
      }
    }
        
    // 8. Event listeners para campos del formulario mejorados
    const formFields = form.querySelectorAll('input, select');
    formFields.forEach(field => {
      field.addEventListener('blur', function() {
        validateField(this);
      });
      
      field.addEventListener('input', function() {
        // Para el tel√©fono, formatear entrada
        if (this.id === 'telefono') {
          let value = this.value.replace(/\D/g, '');
          if (value.length > 10) {
            value = value.slice(0, 15);
          }
          this.value = value;
        }
        showError(this.id, false);
        
        // Quitar estado de validaci√≥n al modificar
        this.classList.remove('field-valid', 'field-invalid');
      });
      
      if (field.tagName === 'SELECT') {
        field.addEventListener('change', function() {
          validateField(this);
        });
      }
    });
    
    // üÜï NUEVO: Event listener espec√≠fico para el campo estado
    const estadoField = document.getElementById('estado');
    if (estadoField) {
      estadoField.addEventListener('change', function() {
        const estadoSeleccionado = this.value;
        console.log(`üèõÔ∏è Estado seleccionado: ${estadoSeleccionado}`);
        
        if (estadoSeleccionado) {
          const promotor = resolverPromotor(estadoSeleccionado);
          mostrarInfoPromotor(promotor);
        } else {
          // Ocultar info si no hay estado seleccionado
          const infoElement = document.getElementById('promotor-info');
          if (infoElement) {
            infoElement.classList.add('hidden');
          }
        }
      });
    }
    
    // 9. Event listeners principales
    closeToastButton.addEventListener('click', function() {
      if (toastTimer) {
        clearTimeout(toastTimer);
      }
      toastNotification.classList.add('hidden');
    });
    
    // üîÑ MODIFICADO: Manejar el env√≠o del formulario con datos enriquecidos
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Limpiar mensajes previos
      submitStatus.textContent = '';
      const errorMessages = document.querySelectorAll('.error-message');
      errorMessages.forEach(msg => {
        msg.classList.add('hidden');
      });
      
      // Validar todos los campos (l√≥gica existente)
      let isValid = true;
      formFields.forEach(field => {
        if (!validateField(field)) {
          isValid = false;
        }
      });
      
      if (!isValid) {
        showToast('error', 'Por favor complete todos los campos correctamente.', 'Error');
        submitStatus.textContent = 'Error: Formulario incompleto';
        return;
      }
      
      // Estado de carga
      submitButton.disabled = true;
      buttonText.textContent = 'Enviando...';
      buttonSpinner.classList.remove('hidden');
      submitStatus.textContent = 'Enviando formulario...';
      
      try {
        const formData = new FormData(form);
        const formObject = {};
        
        formData.forEach(function(value, key) {
          formObject[key] = value;
        });
        
        console.log("üìù Datos originales del formulario:", JSON.stringify(formObject, null, 2));
        
        // üÜï NUEVA L√ìGICA: Resolver promotor basado en estado
        const estadoSeleccionado = formObject.estado;
        const promotorAsignado = resolverPromotor(estadoSeleccionado);
        
        // Validar datos del promotor
        if (!validarDatosPromotor(promotorAsignado)) {
          console.error('‚ùå Datos del promotor inv√°lidos, usando promotor por defecto');
          promotorAsignado = PROMOTOR_DEFAULT;
        }
        
        // üÜï Enriquecer datos del formulario
        const datosEnriquecidos = {
          // Datos originales del formulario (para compatibilidad con Google Sheets)
          ...formObject,
          
          // üÜï Datos estructurados del cliente
          cliente: {
            nombre: formObject.nombre,
            email: formObject.email,
            telefono: formObject.telefono,
            estado: formObject.estado,
            giroComercial: formObject.giroComercial,
            tipoNegocio: formObject.tipoNegocio,
            inicioOperaciones: formObject.inicioOperaciones || formObject.iniciarOperaciones
          },
          
          // üÜï Datos del promotor asignado
          promotor: {
            nombre: promotorAsignado.nombre,
            whatsapp: promotorAsignado.whatsapp,
            email: promotorAsignado.email,
            esDefault: promotorAsignado.esDefault || false,
            zonas: promotorAsignado.zonas || []
          },
          
          // üÜï Metadatos adicionales
          metadata: {
            timestamp: new Date().toISOString(),
            source: 'website-form-v2',
            requiresWhatsapp: true,
            userAgent: navigator.userAgent,
            url: window.location.href
          }
        };
        
        console.log("üöÄ Datos enriquecidos a enviar:", JSON.stringify(datosEnriquecidos, null, 2));
        
        // üîÑ MODIFICADO: Env√≠o al webhook con datos enriquecidos
        const MAKE_WEBHOOK_URL = 'https://hook.us2.make.com/3mknzgigjscwegtansipvrz0163zko73';
        
        const response = await fetch(MAKE_WEBHOOK_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          body: JSON.stringify(datosEnriquecidos)
        });
        
        console.log("üì° Status de respuesta:", response.status);
        
        // Manejo de respuesta (Make.com puede devolver 200, 201, 202, o 204 como √©xito)
        if (response.status >= 200 && response.status < 300) {
          // Respuesta exitosa
          let responseData = {};
          
          try {
            const textResponse = await response.text();
            if (textResponse) {
              responseData = JSON.parse(textResponse);
            }
          } catch (parseError) {
            console.log("‚ö†Ô∏è Respuesta sin JSON v√°lido, pero request exitoso");
            responseData = { status: 'success' };
          }
          
          console.log("‚úÖ Respuesta del servidor:", responseData);
          
          // üÜï MODIFICADO: Mensaje de √©xito personalizado con datos del promotor
          const mensajeExito = promotorAsignado.esDefault 
            ? 'Tu solicitud fue enviada exitosamente. Nuestro equipo se pondr√° en contacto contigo pronto.'
            : `Tu solicitud fue enviada exitosamente. ${promotorAsignado.nombre} se pondr√° en contacto contigo pronto.`;
            
          const tituloExito = '¬°Gracias por tu inter√©s en ser distribuidor KENDA!';
          
          showToast('success', mensajeExito, tituloExito);
          confettiAnimation.start();
          submitStatus.textContent = 'Formulario enviado exitosamente';
          
          // Resetear formulario
          form.reset();
          
          // Limpiar estados visuales
          formFields.forEach(field => {
            field.classList.remove('field-valid', 'field-invalid');
            field.setAttribute('aria-invalid', 'false');
          });
          
          // üÜï Ocultar informaci√≥n del promotor al resetear
          const infoElement = document.getElementById('promotor-info');
          if (infoElement) {
            infoElement.classList.add('hidden');
          }
          
          setTimeout(() => {
            controlPulseAnimation();
          }, 100);
          
        } else {
          // Error del servidor
          const errorText = await response.text();
          console.error("‚ùå Error del servidor:", response.status, errorText);
          throw new Error(`Error HTTP ${response.status}: ${errorText}`);
        }
        
      } catch (error) {
        console.error("‚ùå Error al enviar el formulario:", error);
        showToast('error', 'Hubo un error al enviar el formulario. Por favor, intente nuevamente.', 'Error');
        submitStatus.textContent = 'Error al enviar el formulario';
      } finally {
        // Restaurar estado del bot√≥n
        submitButton.disabled = false;
        buttonText.textContent = 'Enviar formulario';
        buttonSpinner.classList.add('hidden');
      }
    });

    // 10. Inicializaciones
    confettiAnimation.init();
    controlPulseAnimation();
    
    // 11. Funciones para pruebas
    window.testToast = function() {
      showToast('success', 'Tu solicitud fue enviada exitosamente. Nuestro equipo se pondr√° en contacto contigo pronto.', '¬°Gracias por tu inter√©s!');
    };
    
    window.testConfetti = function() {
      confettiAnimation.start();
    };
    
    window.testBoth = function() {
      showToast('success', 'Tu solicitud fue enviada exitosamente. Nuestro equipo se pondr√° en contacto contigo pronto.', '¬°Gracias por tu inter√©s!');
      confettiAnimation.start();
    };
    
    window.testValidation = function(fieldId, value) {
      const campo = document.getElementById(fieldId);
      if (campo) {
        campo.value = value;
        const esValido = validateField(campo);
        console.log(`Campo "${fieldId}" con valor "${value}" es v√°lido: ${esValido}`);
        return esValido;
      }
    };
    
    // üÜï NUEVO: Funciones de testing adicionales para promotores
    window.testPromotor = function(estado) {
      const promotor = resolverPromotor(estado);
      console.log(`üß™ Testing promotor para ${estado}:`, promotor);
      mostrarInfoPromotor(promotor);
      return promotor;
    };
    
    window.testTodosPromotores = function() {
      console.log('üß™ Testing todos los promotores:');
      Object.keys(PROMOTORES_POR_ESTADO).forEach(estado => {
        const promotor = resolverPromotor(estado);
        console.log(`${estado}: ${promotor.nombre} (${promotor.whatsapp})`);
      });
    };
    
    window.testFormularioCompleto = function() {
      // Llenar formulario con datos de prueba
      document.getElementById('nombre').value = 'Juan P√©rez Test';
      document.getElementById('email').value = 'test@example.com';
      document.getElementById('telefono').value = '5555555555';
      document.getElementById('giroComercial').value = 'refaccionaria';
      document.getElementById('estado').value = 'nuevo-leon';
      document.getElementById('tipoNegocio').value = '2000000';
      document.getElementById('iniciarOperaciones').value = '6-meses';
      
      // Disparar evento change para mostrar promotor
      document.getElementById('estado').dispatchEvent(new Event('change'));
      
      console.log('üß™ Formulario llenado con datos de prueba');
    };
    
    // Exponer objetos para debugging
    window.PROMOTORES_POR_ESTADO = PROMOTORES_POR_ESTADO;
    window.resolverPromotor = resolverPromotor;
    window.mostrarInfoPromotor = mostrarInfoPromotor;
  });
</script>